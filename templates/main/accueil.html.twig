{% extends 'base.html.twig' %}

{% block title %} {{ parent() }} | Accueil | {{ parent() }} {% endblock %}


{%  block body %}
    {% if not app.user %}
        <p class="alert alert-warning" style="text-align: center">Pour participer et créer de nouvelles sorties, veuillez vous connecter !</p>
    {% endif %}

    {#    code à utiliser pour afficher l'image de l'user dans le site#}
{#    <p>test pour affichage de l'image utilisateur</p>#}
{#    {% if (app.user) %}#}
{#        {% if(app.user.avatar) %}#}
{#            <p>Ceci est une image qui pourrait accompagner les sorties</p>#}
{#            <div class="avatarpage"#}
{#                 style="background-image: url('{{ asset('img/' ~ app.user.avatar) }}');">#}
{#            </div>#}
{#            <p>Ceci est une image qui pourrait aller dans la navbar</p>#}
{#            <div class="avatarnav"#}
{#                 style="background-image: url('{{ asset('img/' ~ app.user.avatar) }}');">#}
{#            </div>#}
{#        {% else %}#}
{#            <p>Ceci est l'image qui s'affiche si la personne n'as pas chargé sa photo</p>#}
{#            <div class="avatarpage"#}
{#                 style="background-image: url('{{ asset('img/emoticons.jpg') }}');">#}
{#            </div>#}
{#            <p>voici sa version pour la nav bar</p>#}
{#            <div class="avatarnav"#}
{#                 style="background-image: url('{{ asset('img/emoticons.jpg') }}');">#}
{#            </div>#}
{#        {% endif %}#}
{#    {% endif %}#}
{#    <p></p>#}
    {% if app.user %}
        <button  type="button" class="btn btn-outline-warning" onclick="window.location.href ='{{ path('creer') }}'">Creer une sortie</button>
    {% endif %}
    <div class="row">
    <div class="col d-flex justify-content-center">

    <div class="card" style="width: 70rem;">
    <div class="card-body">
        <p class="titreCarte">Rechercher une sortie</p>
    {{ form_start(searchForm) }}
    {{ form_widget(searchForm) }}
    <button  type="submit" class="btn btn-outline-warning">Rechercher</button>
    {{ form_end(searchForm) }}
    </div>
    </div>
    </div>
    </div>
    <br>
    <span class="ghost">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-10">
            <div class="custom-table border">
             <table class="table table-striped border">
             <thead>
                <tr>
                    <th scope="col">Nom sortie</th>
                    <th scope="col">Date sortie</th>
                    <th scope="col">fin inscript.</th>
                    <th scope="col">Inscrits/Places</th>
                    <th scope="col">Etat</th>
                    <th scope="col">Inscrit</th>
                    <th scope="col">Organisateur</th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                 <tbody>
        <!--tableau affichage connectée-->
        {% for sortie in sorties %}
            {% if app.user and sortie.etat.libelle == "Créée" and sortie.organisateur.id == app.user.id%}
            <tr>
                <td>{{ sortie.nom }}</td>
                <td> {{ sortie.dateHeureDebut | date('d/m/Y à H:i')}}</td>
                <td> {{ sortie.dateLimitInscription | date('d/m/Y')}}</td>
                <td> {{ sortie.participant.count }} / {{ sortie.nbInscriptionsMax }}</td>
                <td> {{ sortie.etat.libelle }}</td>
                {% if app.user in sortie.participant %}
                    <td> X </td>
                      {% else %}
                    <td><p> </p></td>
                {% endif %}
                <td><a href="{{ path('utilisateur_profilid', {'id': sortie.organisateur.id}) }}">{{ sortie.organisateur.pseudo }}</a></td>
                {% if app.user %}
                <td> <a href="{{ path('sortie_detailssortie', {'id': sortie.id}) }}">Afficher</a></td>
                    {% else %}
                    <td><p> </p></td>
                {% endif %}
            </tr>
            {% endif %}
        {% endfor %}
        <!--tableau affichage utilisateur déconnecté-->
        {% for sortie in sorties %}
         {% if  sortie.etat.libelle == "Ouverte"
             or sortie.etat.libelle == "Passée"
             or sortie.etat.libelle == "Annulée"
             or sortie.etat.libelle == "Activité en cours"
             or sortie.etat.libelle == "Clôturée"%}
                 <tr>
                <td>{{ sortie.nom }}</td>
                <td> {{ sortie.dateHeureDebut | date('d/m/Y à H:i')}}</td>
                <td> {{ sortie.dateLimitInscription | date('d/m/Y')}}</td>
                <td> {{ sortie.participant.count }} / {{ sortie.nbInscriptionsMax }}</td>
                <td> {{ sortie.etat.libelle }}</td>
                {% if app.user in sortie.participant %}
                    <td> X </td>
                      {% else %}
                    <td><p> </p></td>
                {% endif %}
                <td><a href="{{ path('utilisateur_profilid', {'id': sortie.organisateur.id}) }}">{{ sortie.organisateur.pseudo }}</a></td>
                {% if app.user %}
                    <td> <a href="{{ path('sortie_detailssortie', {'id': sortie.id}) }}">Afficher</a></td>
                    {% else %}
                    <td><p> </p></td>
                {% endif %}
            </tr>
         {% endif %}
        {% endfor %}
        </tbody>
    </table>
    </div>
            </div>
        </div>
    <br>

    </span>
    <p></p>
    <p></p>


    <span class="ghost2">
    {% if (app.user) %}

    <p>Le tableau ci-dessous, avec seulement les sorties presentes dans mon campus,
        s'affiche seulement quand l'écrean est petit (et la navbar change).
        En même temps, le bouton créer une sortie disparaît</p>

    <div class="custom-table ">
        <table class="table table-striped">
            <thead>
            <tr>
                <th scope="col">Campus</th>
                <th scope="col">Nom sortie</th>
                <th scope="col">Date sortie</th>
                <th scope="col">Clôture</th>
                <th scope="col">Inscrits/Places</th>
                <th scope="col">Etat</th>
                <th scope="col">Inscrit</th>
                <th scope="col">Organisateur</th>
                <th scope="col">Actions</th>

            </tr>
            </thead>
            <tbody>

{#           exemple de code pour enchainer les filtres#}
{#            {% for sortie in sorties|filter(sortie => sortie.campus.nom == app.user.campus.nom) | filter(sortie => app.user in sortie.participant)  %}#}


            {% for sortie in sorties|filter(sortie => sortie.campus.nom == app.user.campus.nom) %}
                <tr>
                    <td>{{ sortie.campus.nom }}</td>
                    <td>{{ sortie.nom }}</td>
                    <td> {{ sortie.dateHeureDebut | date('d/m/Y à H:i')}}</td>
                    <td> {{ sortie.dateLimitInscription | date('d/m/Y')}}</td>
                    <td> {{ sortie.participant.count }} / {{ sortie.nbInscriptionsMax }}</td>
                    <td> {{ sortie.etat.libelle }}</td>
                    {% if app.user in sortie.participant %}
                        <td> X </td>
                    {% else %}
                        <td><p> </p></td>
                    {% endif %}
                    <td><a href="{{ path('utilisateur_profilid', {'id': sortie.organisateur.id}) }}">{{ sortie.organisateur.pseudo }}</a></td>
                    <td> <a href="{{ path('sortie_detailssortie', {'id': sortie.id}) }}">Afficher</a></td>

                      {% if "today" < sortie.dateHeureDebut|date_modify("+ 1 month")  %}
                      {% endif %}
                </tr>

            {% endfor %}
            </tbody>
        </table>
    </div>

    {% else %}
    <p>tu n'est pas connecté</p>
    {% endif %}
</span>

{% endblock %}